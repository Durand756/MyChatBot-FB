graph TB
    %% === COUCHE UTILISATEUR ===
    subgraph "ðŸŒ Interface Utilisateur"
        UI[ðŸ“± Frontend HTML/CSS/JS]
        LOGIN[ðŸ” Formulaire Login/Register]
        DASH[ðŸ“Š Dashboard Principal]
        
        subgraph "ðŸ“‹ Onglets Dashboard"
            TAB1[ðŸ“„ Mes Pages]
            TAB2[ðŸ’¬ RÃ©ponses PrÃ©dÃ©finies]
            TAB3[ðŸ¤– Configuration IA]
            TAB4[ðŸ“Š Historique]
        end
    end

    %% === COUCHE APPLICATION ===
    subgraph "âš™ï¸ Serveur Node.js"
        SERVER[ðŸš€ Express Server]
        
        subgraph "ðŸ”’ Authentification"
            AUTH[ðŸ›¡ï¸ Middleware JWT]
            BCRYPT[ðŸ” Hash Passwords]
            SESSION[ðŸ“ Express Session]
        end
        
        subgraph "ðŸŒ API Routes"
            API_AUTH[POST /api/login, /register]
            API_PAGES[GET/POST /api/facebook/*]
            API_RESP[GET/POST /api/responses]
            API_AI[POST /api/ai-config]
            API_HIST[GET /api/history]
            WEBHOOK[GET/POST /webhook]
        end
        
        subgraph "ðŸ¤– Moteur Chatbot"
            MSG_HANDLER[ðŸ“¨ handleMessage]
            MATCH_LOGIC[ðŸŽ¯ Correspondance Mots-clÃ©s]
            AI_FALLBACK[ðŸ§  GÃ©nÃ©ration IA Fallback]
            FB_SENDER[ðŸ“¤ sendMessage Facebook]
        end
    end

    %% === COUCHE DONNÃ‰ES ===
    subgraph "ðŸ’¾ Base de DonnÃ©es"
        DB_TYPE{Base de DonnÃ©es}
        MYSQL[(ðŸ¬ MySQL Production)]
        SQLITE[(ðŸ“ SQLite Fallback)]
        
        subgraph "ðŸ“Š Tables"
            T_USERS[(ðŸ‘¥ users)]
            T_PAGES[(ðŸ“„ facebook_pages)]
            T_RESPONSES[(ðŸ’¬ predefined_responses)]
            T_AI[(ðŸ¤– ai_configs)]
            T_HISTORY[(ðŸ“œ message_history)]
        end
    end

    %% === SERVICES EXTERNES ===
    subgraph "ðŸŒ Services Externes"
        FB_API[ðŸ“˜ Facebook Graph API]
        
        subgraph "ðŸ§  Fournisseurs IA"
            OPENAI[ðŸ¤– OpenAI GPT]
            MISTRAL[âš¡ Mistral AI]
            CLAUDE[ðŸ§  Anthropic Claude]
        end
        
        FB_WEBHOOK[ðŸ“¨ Facebook Webhooks]
    end

    %% === FLUX UTILISATEUR ===
    USER[ðŸ‘¤ Utilisateur] --> UI
    UI --> LOGIN
    LOGIN --> API_AUTH
    API_AUTH --> AUTH
    AUTH --> DASH
    
    DASH --> TAB1
    DASH --> TAB2
    DASH --> TAB3
    DASH --> TAB4
    
    %% === FLUX DE CONNEXION ===
    TAB1 --> API_PAGES
    API_PAGES --> T_PAGES
    T_PAGES --> FB_API
    
    %% === FLUX RÃ‰PONSES ===
    TAB2 --> API_RESP
    API_RESP --> T_RESPONSES
    
    %% === FLUX IA ===
    TAB3 --> API_AI
    API_AI --> T_AI
    
    %% === FLUX HISTORIQUE ===
    TAB4 --> API_HIST
    API_HIST --> T_HISTORY
    
    %% === FLUX WEBHOOK/MESSAGES ===
    FB_WEBHOOK --> WEBHOOK
    WEBHOOK --> MSG_HANDLER
    MSG_HANDLER --> T_PAGES
    MSG_HANDLER --> MATCH_LOGIC
    MATCH_LOGIC --> T_RESPONSES
    MATCH_LOGIC --> AI_FALLBACK
    AI_FALLBACK --> T_AI
    AI_FALLBACK --> OPENAI
    AI_FALLBACK --> MISTRAL
    AI_FALLBACK --> CLAUDE
    MSG_HANDLER --> FB_SENDER
    FB_SENDER --> FB_API
    MSG_HANDLER --> T_HISTORY
    
    %% === CONFIGURATION BDD ===
    SERVER --> DB_TYPE
    DB_TYPE -->|Production| MYSQL
    DB_TYPE -->|Fallback/Dev| SQLITE
    MYSQL --> T_USERS
    MYSQL --> T_PAGES
    MYSQL --> T_RESPONSES
    MYSQL --> T_AI
    MYSQL --> T_HISTORY
    
    %% === SÃ‰CURITÃ‰ ===
    AUTH --> BCRYPT
    SERVER --> SESSION
    
    %% === STYLES ===
    classDef frontend fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef backend fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef database fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    classDef external fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef security fill:#ffebee,stroke:#b71c1c,stroke-width:2px
    
    class UI,LOGIN,DASH,TAB1,TAB2,TAB3,TAB4 frontend
    class SERVER,API_AUTH,API_PAGES,API_RESP,API_AI,API_HIST,WEBHOOK,MSG_HANDLER,MATCH_LOGIC,AI_FALLBACK,FB_SENDER backend
    class DB_TYPE,MYSQL,SQLITE,T_USERS,T_PAGES,T_RESPONSES,T_AI,T_HISTORY database
    class FB_API,FB_WEBHOOK,OPENAI,MISTRAL,CLAUDE external
    class AUTH,BCRYPT,SESSION security
